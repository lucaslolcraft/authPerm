{
  "openapi": "3.0.0",
  "info": {
    "title": "API - Sistema de Permissionamento",
    "version": "1.0.0",
    "description": "API para gerenciamento de usuários, grupos, permissões e controle de acesso"
  },

  "servers": [
    { "url": "http://localhost:3000" }
  ],

  "tags": [
    { "name": "Sistemas" },
    { "name": "Permissões" },
    { "name": "Grupos" },
    { "name": "Usuários" },
    { "name": "Autorização" }
  ],

  "paths": {

    "/sistemas": {
      "get": {
        "tags": ["Sistemas"],
        "summary": "Listar sistemas",
        "responses": {
          "200": {
            "description": "Lista de sistemas",
            "content": {
              "application/json": {
                "example": [
                  { "id": 1, "nome": "Financeiro", "descricao": "Sistema financeiro" }
                ],
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Sistema" }
                }
              }
            }
          }
        }
      },

      "post": {
        "tags": ["Sistemas"],
        "summary": "Criar novo sistema",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/SistemaInput" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Sistema criado",
            "content": {
              "application/json": {
                "example": { "id": 2, "nome": "RH", "descricao": "Sistema de RH" }
              }
            }
          }
        }
      }
    },

    "/sistemas/{id}": {
      "get": {
        "tags": ["Sistemas"],
        "summary": "Buscar sistema por ID",
        "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": {
          "200": { "description": "Sistema encontrado" },
          "404": { "description": "Sistema não encontrado" }
        }
      },

      "put": {
        "tags": ["Sistemas"],
        "summary": "Atualizar sistema",
        "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/SistemaInput" }
            }
          }
        },
        "responses": {
          "200": { "description": "Sistema atualizado" }
        }
      },

      "delete": {
        "tags": ["Sistemas"],
        "summary": "Excluir sistema",
        "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": {
          "200": { "description": "Sistema removido" }
        }
      }
    },

    "/permissoes": {
      "get": {
        "tags": ["Permissões"],
        "summary": "Listar permissões",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": [
                  { "id": 1, "nome": "VER_RELATORIO", "descricao": "Visualizar relatórios", "sistema_id": 1 }
                ],
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Permissao" }
                }
              }
            }
          }
        }
      },

      "post": {
        "tags": ["Permissões"],
        "summary": "Criar permissão",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/PermissaoInput" }
            }
          }
        },
        "responses": {
          "201": { "description": "Permissão criada" }
        }
      }
    },

    "/permissoes/{id}": {
      "get": {
        "tags": ["Permissões"],
        "summary": "Buscar permissão por ID",
        "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": { "200": { "description": "Permissão encontrada" } }
      },

      "put": {
        "tags": ["Permissões"],
        "summary": "Atualizar permissão",
        "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/PermissaoInput" }
            }
          }
        },
        "responses": { "200": { "description": "Permissão atualizada" } }
      },

      "delete": {
        "tags": ["Permissões"],
        "summary": "Excluir permissão",
        "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": { "200": { "description": "Permissão removida" } }
      }
    },

    "/grupos": {
      "get": {
        "tags": ["Grupos"],
        "summary": "Listar grupos",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": [
                  { "id": 1, "nome": "Administradores", "sistema_id": 1 }
                ],
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Grupo" }
                }
              }
            }
          }
        }
      },

      "post": {
        "tags": ["Grupos"],
        "summary": "Criar grupo",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/GrupoInput" }
            }
          }
        },
        "responses": { "201": { "description": "Grupo criado" } }
      }
    },

    "/grupos/{id}": {
      "get": {
        "tags": ["Grupos"],
        "summary": "Buscar grupo por ID",
        "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": { "200": { "description": "Grupo encontrado" } }
      },
      "put": {
        "tags": ["Grupos"],
        "summary": "Atualizar grupo",
        "parameters": [{ "name": "id", "in": "path", "required": true }],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/GrupoInput" }
            }
          }
        },
        "responses": { "200": { "description": "Grupo atualizado" } }
      },
      "delete": {
        "tags": ["Grupos"],
        "summary": "Excluir grupo",
        "parameters": [{ "name": "id", "in": "path", "required": true }],
        "responses": { "200": { "description": "Grupo removido" } }
      }
    },

    "/usuarios": {
      "get": {
        "tags": ["Usuários"],
        "summary": "Listar usuários",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": [
                  { "id": 1, "nome": "Lucas", "email": "lucas@email.com" }
                ],
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Usuario" }
                }
              }
            }
          }
        }
      },

      "post": {
        "tags": ["Usuários"],
        "summary": "Criar usuário",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UsuarioInput" }
            }
          }
        },
        "responses": { "201": { "description": "Usuário criado" } }
      }
    },

    "/usuarios/{id}": {
      "get": {
        "tags": ["Usuários"],
        "summary": "Buscar usuário por ID",
        "parameters": [{ "name": "id", "in": "path", "required": true }],
        "responses": { "200": { "description": "Usuário encontrado" } }
      },
      "put": {
        "tags": ["Usuários"],
        "summary": "Atualizar usuário",
        "parameters": [{ "name": "id", "in": "path", "required": true }],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UsuarioInput" }
            }
          }
        },
        "responses": { "200": { "description": "Usuário atualizado" } }
      },
      "delete": {
        "tags": ["Usuários"],
        "summary": "Excluir usuário",
        "parameters": [{ "name": "id", "in": "path", "required": true }],
        "responses": { "200": { "description": "Usuário removido" } }
      }
    },

    "/usuarios/{usuario_id}/grupos/{grupo_id}": {
      "post": {
        "tags": ["Usuários"],
        "summary": "Vincular usuário a grupo",
        "parameters": [
          { "name": "usuario_id", "in": "path", "required": true },
          { "name": "grupo_id", "in": "path", "required": true }
        ],
        "responses": { "200": { "description": "Usuário vinculado ao grupo" } }
      }
    },

    "/grupos/{grupo_id}/permissoes/{permissao_id}": {
      "post": {
        "tags": ["Grupos"],
        "summary": "Vincular permissão a grupo",
        "parameters": [
          { "name": "grupo_id", "in": "path", "required": true },
          { "name": "permissao_id", "in": "path", "required": true }
        ],
        "responses": { "200": { "description": "Permissão vinculada ao grupo" } }
      }
    },

    "/auth/permissoes/{usuario_id}": {
      "get": {
        "tags": ["Autorização"],
        "summary": "Buscar permissões do usuário",
        "parameters": [{ "name": "usuario_id", "in": "path", "required": true }],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": {
                  "usuario_id": 1,
                  "permissoes": [
                    {
                      "nome": "VER_RELATORIO",
                      "descricao": "Visualizar relatórios",
                      "sistema": "Financeiro"
                    }
                  ]
                }
              }
            }
          }
        }
      }
    }

  },

  "components": {
    "schemas": {

      "Sistema": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "nome": { "type": "string" },
          "descricao": { "type": "string" }
        }
      },

      "SistemaInput": {
        "type": "object",
        "properties": {
          "nome": { "type": "string" },
          "descricao": { "type": "string" }
        }
      },

      "Permissao": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "nome": { "type": "string" },
          "descricao": { "type": "string" },
          "sistema_id": { "type": "integer" }
        }
      },

      "PermissaoInput": {
        "type": "object",
        "properties": {
          "nome": { "type": "string" },
          "descricao": { "type": "string" },
          "sistema_id": { "type": "integer" }
        }
      },

      "Grupo": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "nome": { "type": "string" },
          "sistema_id": { "type": "integer" }
        }
      },

      "GrupoInput": {
        "type": "object",
        "properties": {
          "nome": { "type": "string" },
          "sistema_id": { "type": "integer" }
        }
      },

      "Usuario": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "nome": { "type": "string" },
          "email": { "type": "string" }
        }
      },

      "UsuarioInput": {
        "type": "object",
        "properties": {
          "nome": { "type": "string" },
          "email": { "type": "string" }
        }
      }
    }
  }
}
